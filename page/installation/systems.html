<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="FTorch - A library for coupling (Py)Torch machine learning models to Fortran codes.Written in modern Fortran (2008) with source code available on GitHub it has been used in multiple scientific projects.The associated JOSS paper can read here.">
    <meta name="author" content="ICCS Cambridge" >
    <link rel="icon" href="../../favicon.png">

    <title>System-Specific Guidance &ndash; FTorch</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../../css/fontawesome.min.css" rel="stylesheet">
    <link href="../../css/brands.min.css" rel="stylesheet">
    <link href="../../css/regular.min.css" rel="stylesheet">
    <link href="../../css/solid.min.css" rel="stylesheet">
    <link href="../../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../../css/local.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
      <link href="../../css/user.css" rel="stylesheet">
    <script src="../../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../../index.html">FTorch </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="../index.html">User Guide</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>System-Specific Guidance</h1>
    <div class="container p-2 mb-4 bg-light border rounded-3">
      <div class="row align-items-center justify-content-between">
        <div class="col">
          <ul class="list-inline" style="margin-bottom:0px; display:inline">
              <li class="list-inline-item" id="author"><i class="fa fa-pencil"></i> Jack Atkinson</li>
              <li class="list-inline-item" id="date"><i class="fa fa-calendar-o"></i> Last Updated: October 2025</li>
          </ul>
        </div>
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../index.html'>User Guide</a></li>
                <li class="breadcrumb-item"><a href='index.html'>Installation</a></li>
              <li class="breadcrumb-item active" aria-current="page">System-Specific Guidance</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-3">
        <div class="card card-body bg-light" id="sidebar-toc">
          <ul class="nav flex-column align-items">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">User Guide</a>
            </li>
          </ul>
          <hr>
          <nav class="nav nav-pills flex-column">
              <a class="nav-link" href="index.html">Installation</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="general.html">Installation and Build</a>
              <a class="nav-link active disabled" href="systems.html">System-Specific Guidance</a>
              <a class="nav-link" href="gpu.html">GPU Support</a>
              <a class="nav-link" href="hpc.html">HPC Support</a>

                </nav>
              <a class="nav-link" href="../usage/index.html">Usage</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../usage/generic_example.html">Generic Example</a>
              <a class="nav-link" href="../usage/worked_examples.html">Worked Examples</a>
              <a class="nav-link" href="../usage/tensor.html">Tensor API</a>
              <a class="nav-link" href="../usage/transposing.html">When to transpose data</a>
              <a class="nav-link" href="../usage/batching.html">Batching</a>
              <a class="nav-link" href="../usage/offline.html">Offline training</a>
              <a class="nav-link" href="../usage/online.html">Online training</a>
              <a class="nav-link" href="../usage/troubleshooting.html">Troubleshooting</a>

                </nav>
              <a class="nav-link" href="../community/index.html">Community</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../community/news_archive.html">News archive</a>
              <a class="nav-link" href="../community/presentations.html">Presentations</a>
              <a class="nav-link" href="../community/case_studies.html">FTorch Case Studies</a>
              <a class="nav-link" href="../community/changelog.html">FTorch Changelog</a>

                </nav>
              <a class="nav-link" href="../developer/index.html">Developer Guide</a>
                <nav class="nav nav-pills flex-column">
                                <a class="nav-link" href="../developer/developer.html">Developer Guide</a>
              <a class="nav-link" href="../developer/testing.html">FTorch test suite</a>

                </nav>
              <a class="nav-link" href="../LICENSE.html">FTorch License</a>
          </nav>
        </div>
      </div>

    <div class="col-9" id='text'>
      <h2 id="system-specific-guidance">System-Specific Guidance</h2>
<ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#macos-apple-silicon">MacOS (Apple Silicon)</a></li>
<li><a href="#conda">Conda</a></li>
<li><a href="#github-codespace">GitHub Codespace</a></li>
</ul>
<h3 id="windows">Windows</h3>
<p>If possible we recommend using the <a href="https://learn.microsoft.com/en-us/windows/wsl/">Windows Subsystem for Linux</a> (WSL) to build
the library. In this case the build process is the same as for a Linux environment.</p>
<p>Building in Windows itself can be done using Visual Studio and the Intel Fortran
resources. The following additional dependencies are also required:</p>
<ul>
<li><a href="https://visualstudio.microsoft.com/">Visual Studio</a> ensuring C++ tools are selected and installed.</li>
<li><a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/base-toolkit-download.html">Intel OneAPI Basetoolkit</a></li>
<li><a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit.html">Intel OneAPI HPC toolkit</a> ensuring that the Intel Fortran compiler and VS integration is selected.</li>
</ul>
<p>Note that LibTorch is <em>not</em> supported for the GNU Fortran compiler with MinGW.</p>
<h4 id="installation">Installation</h4>
<p>Load the Intel Fortran compilers using <code>setvars.bat</code> which is found in the Intel compiler install
directory (see the <a href="https://www.intel.com/content/www/us/en/docs/oneapi/programming-guide/2023-2/use-the-setvars-script-with-windows.html">Intel
docs</a>)
for more details.</p>
<p>From <code>cmd</code> this can be done with:</p>
<div class="codehilite"><pre><span></span><code><span class="n">call</span><span class="w"> </span><span class="s2">&quot;C:\Program Files (x86)\Intel\oneAPI\setvars.bat&quot;</span>
</code></pre></div>

<p>FTorch can then be built according to the <a href="general.html">regular CMake instructions</a>,
with the addition of <code>-G "NMake Makefiles"</code>.</p>
<p>So the basic command to build from <code>cmd</code> becomes:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cmake</span><span class="w"> </span><span class="o">-</span><span class="n">G</span><span class="w"> </span><span class="s2">&quot;NMake Makefiles&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_PREFIX_PATH</span><span class="o">=</span><span class="s2">&quot;C:\Users\&lt;path-to-libtorch-download&gt;\libtorch&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Release</span><span class="w"> </span><span class="o">..</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">build</span><span class="w"> </span><span class="o">.</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="o">.</span>
</code></pre></div>

<blockquote>
<p>Note: <em>In a Windows environment administrator privileges are required for the default install location.</em></p>
</blockquote>
<p>The following is an example <code>cmd</code> script that installs FTorch and runs the integration tests. It assumes you have already
installed CMake, git, the Intel compilers, and Visual Studio. There are a few
places where output is turned on or off using the <code>ECHO</code> command. If you are
experiencing issues with the install then it may be helpful to set <code>ECHO ON</code>
throughout.</p>
<div class="codehilite"><pre><span></span><code><span class="n">rem</span><span class="w"> </span><span class="n">Disable</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">now</span>
<span class="n">ECHO</span><span class="w"> </span><span class="n">OFF</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Load</span><span class="w"> </span><span class="n">intel</span><span class="w"> </span><span class="n">compilers</span>
<span class="n">call</span><span class="w"> </span><span class="s2">&quot;C:\Program Files (x86)\Intel\oneAPI\setvars.bat&quot;</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Download</span><span class="w"> </span><span class="n">ftorch</span>
<span class="n">git</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Cambridge</span><span class="o">-</span><span class="n">ICCS</span><span class="o">/</span><span class="n">FTorch</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span><span class="w"> </span><span class="n">FTorch</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">environment</span>
<span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">venv</span><span class="w"> </span><span class="o">.</span><span class="n">ftorch</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Activate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">environment</span>
<span class="n">call</span><span class="w"> </span><span class="o">.</span><span class="n">ftorch</span>\<span class="n">Scripts</span>\<span class="n">activate</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">torch</span>
<span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">torch</span><span class="w"> </span><span class="n">torchvision</span><span class="w"> </span><span class="n">torchaudio</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">output</span>
<span class="n">ECHO</span><span class="w"> </span><span class="n">ON</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">Torch</span><span class="w"> </span><span class="n">location</span>
<span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="s2">&quot;tokens=2*&quot;</span><span class="w"> </span><span class="o">%%</span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pip show torch ^| findstr /R &quot;^Location&quot;&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">torch_path</span><span class="o">=%%</span><span class="n">i</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">CMake</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">scripts</span>
<span class="n">rem</span><span class="w"> </span><span class="p">(</span><span class="n">Update</span><span class="w"> </span><span class="n">CMAKE_PREFIX_PATH</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ftorch</span><span class="w"> </span><span class="n">venv</span><span class="p">)</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">-</span><span class="n">Bbuild</span><span class="w"> </span><span class="o">-</span><span class="n">G</span><span class="w"> </span><span class="s2">&quot;NMake Makefiles&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_Fortran_FLAGS</span><span class="o">=</span><span class="s2">&quot;/fpscomp:logicals&quot;</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_PREFIX_PATH</span><span class="o">=</span><span class="s2">&quot;%torch_path%&quot;</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Release</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_BUILD_TESTS</span><span class="o">=</span><span class="n">True</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_Fortran_COMPILER</span><span class="o">=</span><span class="n">ifx</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">icx</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">icx</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_Fortran_FLAGS</span><span class="o">=</span><span class="s2">&quot;/fpscomp:logicals&quot;</span><span class="w"> </span><span class="o">^</span>
<span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_CXX_FLAGS</span><span class="o">=</span><span class="s2">&quot;/D_ALLOW_COMPILER_AND_STL_VERSION_MISMATCH&quot;</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">FTorch</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">build</span><span class="w"> </span><span class="n">build</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="n">build</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Quit</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">raises</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span>
<span class="k">if</span><span class="w"> </span><span class="o">%</span><span class="n">errorlevel</span><span class="o">%</span><span class="w"> </span><span class="n">neq</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="w"> </span><span class="o">%</span><span class="n">errorlevel</span><span class="o">%</span>

<span class="n">ECHO</span><span class="w"> </span><span class="n">OFF</span>
<span class="n">rem</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">FTorch</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">PyTorch</span><span class="w"> </span><span class="n">libs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">path</span>
<span class="n">rem</span><span class="w"> </span><span class="p">(</span><span class="n">Update</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">installed</span><span class="w"> </span><span class="n">FTorch</span><span class="p">)</span>
<span class="n">set</span><span class="w"> </span><span class="n">PATH</span><span class="o">=</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span><span class="w"> </span><span class="n">Files</span><span class="w"> </span><span class="p">(</span><span class="n">x86</span><span class="p">)</span>\<span class="n">FTorch</span>\<span class="n">bin</span><span class="p">;</span><span class="o">%</span><span class="n">PATH</span><span class="o">%</span>
<span class="n">set</span><span class="w"> </span><span class="n">PATH</span><span class="o">=%</span><span class="n">torch_path</span><span class="o">%</span><span class="p">;</span><span class="o">%</span><span class="n">PATH</span><span class="o">%</span>
<span class="n">set</span><span class="w"> </span><span class="n">PATH</span><span class="o">=%</span><span class="n">torch_path</span><span class="o">%</span>\<span class="n">torch</span>\<span class="n">lib</span><span class="p">;</span><span class="o">%</span><span class="n">PATH</span><span class="o">%</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">integration</span><span class="w"> </span><span class="n">tests</span>
<span class="n">ECHO</span><span class="w"> </span><span class="n">ON</span>
<span class="n">ctest</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="w"> </span><span class="o">--</span><span class="n">tests</span><span class="o">-</span><span class="n">regex</span><span class="w"> </span><span class="n">example1</span>
<span class="n">ctest</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="w"> </span><span class="o">--</span><span class="n">tests</span><span class="o">-</span><span class="n">regex</span><span class="w"> </span><span class="n">example2</span>
<span class="n">ctest</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="w"> </span><span class="o">--</span><span class="n">tests</span><span class="o">-</span><span class="n">regex</span><span class="w"> </span><span class="n">example3</span>
<span class="n">ctest</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="w"> </span><span class="o">--</span><span class="n">tests</span><span class="o">-</span><span class="n">regex</span><span class="w"> </span><span class="n">example4</span>
<span class="n">ctest</span><span class="w"> </span><span class="o">--</span><span class="n">verbose</span><span class="w"> </span><span class="o">--</span><span class="n">tests</span><span class="o">-</span><span class="n">regex</span><span class="w"> </span><span class="n">example8</span>
<span class="k">if</span><span class="w"> </span><span class="o">%</span><span class="n">errorlevel</span><span class="o">%</span><span class="w"> </span><span class="n">neq</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="w"> </span><span class="o">%</span><span class="n">errorlevel</span><span class="o">%</span>
</code></pre></div>

<p>Here the <code>/fpscomp:logicals</code> flag is used to ensure Fortran logicals are
compatible with those used by PyTorch. The
<code>/D_ALLOW_COMPILER_AND_STL_VERSION_MISMATCH</code> flag is used to suppress warnings
related to mismatched compiler versions between the Intel compilers and
those used to build LibTorch.</p>
<p>We recommend Windows users review the Windows continuous integration workflow
(<a href="https://github.com/Cambridge-ICCS/FTorch/blob/main/.github/workflows/test_suite_windows_cpu_intel.yml"><code>.github/workflows/test_suite_windows_cpu_intel.yml</code></a>)
for more information, as this provides another example of how to build and run
FTorch and its integration tests.</p>
<p>If using powershell the setvars and build commands become:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cmd</span><span class="w"> </span><span class="o">/</span><span class="n">k</span><span class="w"> </span><span class="s1">&#39;&quot;C:\Program Files (x86)\Intel\oneAPI\setvars.bat&quot; &amp;&amp; powershell&#39;</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">-</span><span class="n">G</span><span class="w"> </span><span class="s2">&quot;NMake Makefiles&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_PREFIX_PATH</span><span class="o">=</span><span class="s2">&quot;C:\Users\&lt;path-to-libtorch-download&gt;\libtorch&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Release</span><span class="w"> </span><span class="o">..</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">build</span><span class="w"> </span><span class="o">.</span>
<span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="o">.</span>
</code></pre></div>

<h3 id="macos-apple-silicon">MacOS (Apple Silicon)</h3>
<p>FTorch can be built on MacOS Apple Silicon machines, including utilising
the MPS backend, by following the
<a href="general.html">regular CMake instructions</a> with a few additions as
detailed below.</p>
<p>To leverage MPS include the <code>-DGPU_DEVICE=MPS</code>
<a href="general.html#cmake-build-options">CMake flag</a> at build time.</p>
<h4 id="dependencies">Dependencies</h4>
<p>The system clang compilers (<code>clang</code> and <code>clang++</code>) should be used for C and C++.
This avoids ABI incompatibilities with LibTorch and ensures proper linkage with
macOS system libraries.</p>
<p>Apple does not provide a Fortran compiler so users will need to install one.
We recommend GNU's <code>gfortran</code> which comes with GCC.</p>
<p>Users will additionally need to install OpenMP (and, for some examples, Open-MPI).
This can be done e.g. using the <a href="https://brew.sh/">homebrew package manager</a> with:</p>
<div class="codehilite"><pre><span></span><code>brew install gcc openmpi libomp
</code></pre></div>

<h4 id="building">Building</h4>
<p>MacOS requires explicit linking to the C++ standard library and OpenMP support via
<code>libomp</code>. This can be done through C and C++ flags at compilation time:
  - <code>-Xpreprocessor -fopenmp</code> which tells clang to use OpenMP, with <code>-Xpreprocessor</code>
    passing the flag to the preprocessor,
  - <code>-I&lt;path/to/libomp&gt;/include</code> to find OpenMP headers,
  - <code>-stdlib=libc++</code> to ensure use of the native MacOS C++ standard library, and
  - <code>-L&lt;path/to/libomp&gt;/lib -lomp</code> to link against the OpenMP library.</p>
<p>If using homebrew you can replace <code>&lt;path/to/libomp&gt;</code> with <code>$(brew --prefix libomp)</code>.</p>
<p>Example CMake command:</p>
<div class="codehilite"><pre><span></span><code>cmake<span class="w"> </span>..<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_Fortran_COMPILER<span class="o">=</span>gfortran<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_C_FLAGS<span class="o">=</span><span class="s2">&quot;-Xpreprocessor -fopenmp -I&lt;path/to/libomp&gt;/include&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_CXX_FLAGS<span class="o">=</span><span class="s2">&quot;-stdlib=libc++ -Xpreprocessor -fopenmp -I&lt;path/to/libomp&gt;/include&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DCMAKE_EXE_LINKER_FLAGS<span class="o">=</span><span class="s2">&quot;-L&lt;path/to/libomp&gt;/lib -lomp&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-DGPU_DEVICE<span class="o">=</span>MPS
cmake<span class="w"> </span>--build<span class="w"> </span>.
cmake<span class="w"> </span>--install<span class="w"> </span>.
</code></pre></div>

<p>To build without support for Apple Silicon MPS acceleration, remove the <code>-DGPU_DEVICE=MPS</code>.</p>
<p>We recommend Mac users review the MacOS continuous integration workflow
(<a href="https://github.com/Cambridge-ICCS/FTorch/blob/main/.github/workflows/test_suite_macos_cpu_clang.yml"><code>.github/workflows/test_suite_macos_cpu_clang.yml</code></a>)
for more information, as this provides another example of how to build and run
FTorch and its integration tests.</p>
<h3 id="conda">Conda</h3>
<p>Conda is not our preferred approach for managing dependencies, but for users who want
an environment to build FTorch in we provide guidance and environment files in a
<a href="https://github.com/Cambridge-ICCS/FTorch/tree/main/conda"><code>conda/</code></a> directory.
Note that these environments are not minimal and will install Python, PyTorch,
and other modules required for running the tests and examples.</p>
<h3 id="github-codespace">GitHub Codespace</h3>
<p>It is possible to try FTorch through an interactive browser session without
installing anything locally using GitHub Codespace.
Full instructions are in the
<a href="https://github.com/Cambridge-ICCS/FTorch/tree/main/codespace"><code>codespace/</code></a> directory.</p>
    </div>
  </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              FTorch
 was developed by ICCS Cambridge<br>              &copy; 2026 <a rel="license" href="https://opensource.org/licenses/MIT">MIT</a>
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>