<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="A library for coupling (Py)Torch machine learning models to Fortran">
    <meta name="author" content="ICCS Cambridge" >
    <link rel="icon" href="../favicon.png">

    <title>Developer Guide &ndash; FTorch</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">FTorch </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">User Guide</a></li>
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>Developer Guide</h1>
    <div class="container p-2 mb-4 bg-light border rounded-3">
      <div class="row align-items-center justify-content-between">
        <div class="col">
          <ul class="list-inline" style="margin-bottom:0px; display:inline">
          </ul>
        </div>
        <div class="col">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='index.html'>User Guide</a></li>
              <li class="breadcrumb-item active" aria-current="page">Developer Guide</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-3">
        <div class="card card-body bg-light" id="sidebar-toc">
          <ul class="nav flex-column align-items">
            <li class="nav-item">
              <a class="nav-link" href="index.html">User Guide</a>
            </li>
          </ul>
          <hr>
          <nav class="nav nav-pills flex-column">
              <a class="nav-link" href="LICENSE.html">FTorch License</a>
              <a class="nav-link" href="cmake.html">Installation and Build Process</a>
              <a class="nav-link active disabled" href="developer.html">Developer Guide</a>
              <a class="nav-link" href="examples.html">Examples</a>
              <a class="nav-link" href="gpu.html">GPU Support</a>
              <a class="nav-link" href="transposing.html">When to transpose data</a>
              <a class="nav-link" href="troubleshooting.html">Troubleshooting</a>
          </nav>
        </div>
      </div>

    <div class="col-9" id='text'>
      <p>If you would like to contribute to the FTorch project, or modify the code at a deeper
level, please see below for guidance.</p>
<div class="toc">
<ul>
<li><a href="#getting-involved">Getting involved</a><ul>
<li><a href="#code-of-conduct">Code of Conduct</a></li>
</ul>
</li>
<li><a href="#extending-the-api">Extending the API</a><ul>
<li><a href="#fortran-source-and-fypp">Fortran source and Fypp</a></li>
<li><a href="#git-hook">git hook</a></li>
<li><a href="#general-guidelines">General guidelines</a></li>
</ul>
</li>
<li><a href="#documentation">Documentation</a></li>
</ul>
</div>
<h2 id="getting-involved">Getting involved</h2>
<p>Contributions and collaborations are welcome.</p>
<p>For bugs, feature requests, and clear suggestions for improvement please
<a href="https://github.com/Cambridge-ICCS/FTorch/issues/new/choose">open an issue</a>.</p>
<p>If you have built something upon <em>FTorch</em> that would be useful to others, or can
address an <a href="https://github.com/Cambridge-ICCS/FTorch/issues">open issue</a>, please
<a href="https://github.com/Cambridge-ICCS/FTorch/fork">fork the repository</a> and open a
pull request.</p>
<h3 id="code-of-conduct">Code of Conduct</h3>
<p>Everyone participating in the FTorch project, and in particular in the
issue tracker, pull requests, and social media activity, is expected to treat other
people with respect and, more generally, to follow the guidelines articulated in the
<a href="https://www.python.org/psf/codeofconduct/">Python Community Code of Conduct</a>.</p>
<h2 id="extending-the-api">Extending the API</h2>
<p>If you have a Torch functionality that you wish to bring in from the C++ API to
the FTorch Fortran API the steps are generally as follows:</p>
<ul>
<li>Modify <code>ctorch.cpp</code> to create a C++ version of the function that accesses <code>torch::&lt;item&gt;</code>.</li>
<li>Add the function to the header file <code>ctorch.h</code></li>
<li>Modify <code>ftorch.fypp</code> to create a Fortran version of the function
  that binds to the version in <code>ctorch.cpp</code>.</li>
</ul>
<p>Details of C++ functionalities available to be wrapped can be found
in the <a href="https://pytorch.org/cppdocs/">libtorch C++ API</a>.</p>
<p>As this is an open-source project we appreciate any contributions
back from users that have extended the functionality.
If you have done something but don't know where to start with
open-source contributions please get in touch!<sup>*</sup></p>
<p><sup>*</sup><em>Our preferred method of contact is via Github issues and discussions,
but if you are unfamiliar with this you can <a href="mailto:jwa34@cam.ac.uk">email ICCS</a>
asking for the FTorch developers.</em></p>
<h3 id="fortran-source-and-fypp">Fortran source and Fypp</h3>
<p>The Fortran source code for FTorch is contained in <code>src/ftorch.f90</code>.
However, this file should not be edited directly, but instead generated from
<code>src/ftorch.fypp</code>.
This is a file that is set up to be run through the
<a href="https://fypp.readthedocs.io/en/stable/index.html">Fypp</a> preprocessor.
We use this because we want to create a pleasant interface of single function calls.
The nature of Fortran means that this requires a lot of repeated combinations of
array shapes and data types under interface structures.
By using Fypp we can generate these programatically.</p>
<p>Fypp can be installed via pip:</p>
<div class="codehilite"><pre><span></span><code>pip install fypp
</code></pre></div>

<p>To generate the Fortran code run:</p>
<div class="codehilite"><pre><span></span><code>fypp src/ftorch.fypp src/ftorch.f90
</code></pre></div>

<p><em>Note: Generally it would be advisable to provide only the <code>.fypp</code> source code to
reduce duplication and confusion. However, because it is a relatively small file
and many of our users wish to </em>"clone-and-go"<em> rather than develop, we provide both.<br>
Development should only take place in <code>ftorch.fypp</code>, however.</em></p>
<h3 id="git-hook">git hook</h3>
<p>In order to streamline the process of uploading we provide a pre-commit hook in
<a href="https://github.com/Cambridge-ICCS/FTorch/blob/main/.githooks/pre-commit"><code>.githooks/pre-commit</code></a>.
This will check that both the <code>.fypp</code> and <code>.f90</code> files have been updated together in a
synchronous fashion before a commmit can take place.
If this does not happen then the second line of defence (GitHub continuous integration)
will fail following the commit.</p>
<p>Use of the hook is not automatic and needs to be enabled by the developer
(after they have inspected it and are happy with its contents).
Hooks can be enabled by placing them in the <code>.git</code> directory with the following commands:</p>
<div class="codehilite"><pre><span></span><code>cp .githooks/pre-commit .git/hooks/
chmod +x .git/pre-commit
</code></pre></div>

<h3 id="general-guidelines">General guidelines</h3>
<ul>
<li>Match optional argument defaults between Fortran, C, and C++<br>
  (<a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">principle of least astonishment</a>).</li>
<li>Handle <code>torch::Error</code> and <code>std::exception</code> in the C++ functions by catching and
  printing to screen before exiting cleanly.</li>
</ul>
<h2 id="documentation">Documentation</h2>
<p>The API documentation for FTorch is generated using 
<a href="https://forddocs.readthedocs.io/en/latest/">FORD</a>.
For detailed information refer to the 
<a href="https://forddocs.readthedocs.io/en/latest/user_guide/index.html">FORD User Guide</a>,
but as a quick-start:</p>
<ul>
<li><code>!!</code> is used to signify documentation.</li>
<li>Documentation comes <em>after</em> whatever it is documenting (inline or subsequent line).</li>
<li>Documentation can precede an item if designated using <code>!&gt;</code>.</li>
</ul>
<p>FORD is pip installable:</p>
<div class="codehilite"><pre><span></span><code>pip install ford
</code></pre></div>

<p>To generate the documentation run:</p>
<div class="codehilite"><pre><span></span><code>ford FTorch.md
</code></pre></div>

<p>from the root of the repository.</p>
<p><code>FTorch.md</code> is the FORD index file, API documentation is automatically generated, and
any further items are contained in <code>pages/</code> as markdown files.</p>
<p>Documentation of the C functions in <code>ctorch.h</code> is provided
by <a href="https://www.doxygen.nl/index.html">Doxygen</a>.</p>
    </div>
  </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              FTorch
 was developed by ICCS Cambridge<br>              &copy; 2024 <a rel="license" href="https://opensource.org/licenses/MIT">MIT</a>
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>